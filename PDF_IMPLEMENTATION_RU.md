# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º PDF

## –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: –í –ø—Ä–æ—Ü–µ—Å—Å–µ

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ:
1. –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF (src/pdf.js)
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ "–î–∂–µ—Ä–µ–ª–æ" (–∏—Å—Ç–æ—á–Ω–∏–∫ —Ç–æ–≤–∞—Ä–∞)
   - –†–∞–∑–¥–µ–ª–µ–Ω—ã –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
   - –î–æ–±–∞–≤–ª–µ–Ω –æ–±—â–∏–π –≤–µ—Å –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
   - –ò–º—è —Ñ–∞–π–ª–∞: "–í—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è_–ì—Ä–∞–≤—ñ—Ç–æ–Ω_22-10-2025_14-35.pdf"

2. –°–æ–∑–¥–∞–Ω–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–≤—å—é PDF (index.html)
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
   - –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF" (—Å–∫–∞—á–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ)
   - –ö–Ω–æ–ø–∫–∞ "–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏" (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)
   - –ö–Ω–æ–ø–∫–∞ "–°–∫–∞—Å—É–≤–∞—Ç–∏" (–æ—Ç–º–µ–Ω–∞)

3. –î–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ (styles.css)
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
   - –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã

### üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ:
4. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (app.js) - –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì
5. –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å PDF –Ω–∞ —Å–µ—Ä–≤–µ—Ä (network.js –∏–ª–∏ src/network.js)
6. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å submitDraft() —Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π
7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞

---

## –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –£–ª—É—á—à–µ–Ω–∏—è –≤ PDF (src/pdf.js)

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ç–∞–±–ª–∏—Ü—ã:
```javascript
// –ë–´–õ–û:
const TABLE_COLUMNS = [
    { key: 'productName', title: '–¢–æ–≤–∞—Ä', width: 220 },
    { key: 'quantity', title: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å', width: 80 },
    { key: 'unit', title: '–û–¥.', width: 50 },
    { key: 'pricePerUnit', title: '–¶—ñ–Ω–∞', width: 90 },
    { key: 'totalAmount', title: '–°—É–º–∞', width: 95 }
];

// –°–¢–ê–õ–û:
const TABLE_COLUMNS = [
    { key: 'productName', title: '–¢–æ–≤–∞—Ä', width: 150 },
    { key: 'quantity', title: '–ö—ñ–ª—å–∫.', width: 55 },
    { key: 'unit', title: '–û–¥.', width: 40 },
    { key: 'source', title: '–î–∂–µ—Ä–µ–ª–æ', width: 95 },    // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
    { key: 'pricePerUnit', title: '–¶—ñ–Ω–∞', width: 70 },
    { key: 'totalAmount', title: '–°—É–º–∞', width: 70 }
];
```

#### –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞:
```javascript
function formatSource(source) {
    if (!source) {
        return '‚Äî';
    }
    if (source === 'purchase') {
        return '–ó–∞–∫—É–ø–∫–∞';
    }
    // –ù–∞–∑–≤–∞–Ω–∏—è —Å–∫–ª–∞–¥–æ–≤ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ë—É—á–∞")
    return source;
}
```

#### –£–ª—É—á—à–µ–Ω—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ PDF:
```javascript
// –ë–´–õ–û:
const metadata = {
    storeName,
    submittedAt: new Date(submittedAt).toLocaleString('uk-UA'),
    itemsCount: resolvedItems.length,
    totalAmount: formatMoney(totalAmount),
    summary: summary || '–î–æ–∫—É–º–µ–Ω—Ç –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ...'
};

// –°–¢–ê–õ–û:
const metadata = {
    storeName,
    date: dateStr,           // ‚Üê –û—Ç–¥–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞: "22.10.2025"
    time: timeStr,           // ‚Üê –û—Ç–¥–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: "14:35"
    submittedAt: dateObj,    // ‚Üê –û–±—ä–µ–∫—Ç Date –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    itemsCount: resolvedItems.length,
    totalAmount: formatMoney(totalAmount),
    totalWeight: calculatedWeight,  // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û: –æ–±—â–∏–π –≤–µ—Å –≤ –∫–≥
    summary: summary || '...'
};
```

#### –£–ª—É—á—à–µ–Ω —Ñ–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞:
```javascript
// –ë–´–õ–û:
const fileName = `${safeStoreName}-${timestamp}.pdf`;
// –ü—Ä–∏–º–µ—Ä: graviton-2025-10-22T14-35-22-000Z.pdf

// –°–¢–ê–õ–û:
const fileName = `–í—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è_${storeName}_${dateForFile}_${timeForFile}.pdf`;
// –ü—Ä–∏–º–µ—Ä: –í—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è_–ì—Ä–∞–≤—ñ—Ç–æ–Ω_22-10-2025_14-35.pdf
```

### 2. –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–≤—å—é (index.html)

HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```html
<div class="modal-overlay" id="pdfPreviewModal">
    <div class="modal-content glassmorphism pdf-preview-modal">
        <div class="modal-header">
            <h3>üìÑ –ó–≤—ñ—Ç –≥–æ—Ç–æ–≤–∏–π –¥–æ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏</h3>
            <button class="modal-close" id="closePdfPreviewBtn">
                <i data-lucide="x"></i>
            </button>
        </div>

        <div class="pdf-preview-content">
            <div class="pdf-info-card glassmorphism">
                <!-- –ú–∞–≥–∞–∑–∏–Ω -->
                <div class="pdf-info-row">
                    <span class="pdf-info-label">–ú–∞–≥–∞–∑–∏–Ω:</span>
                    <span class="pdf-info-value" id="pdfStoreName">‚Äî</span>
                </div>

                <!-- –î–∞—Ç–∞ -->
                <div class="pdf-info-row">
                    <span class="pdf-info-label">–î–∞—Ç–∞:</span>
                    <span class="pdf-info-value" id="pdfDate">‚Äî</span>
                </div>

                <!-- –í—Ä–µ–º—è -->
                <div class="pdf-info-row">
                    <span class="pdf-info-label">–ß–∞—Å:</span>
                    <span class="pdf-info-value" id="pdfTime">‚Äî</span>
                </div>

                <div class="pdf-info-divider"></div>

                <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ -->
                <div class="pdf-info-row">
                    <span class="pdf-info-label">–¢–æ–≤–∞—Ä—ñ–≤:</span>
                    <span class="pdf-info-value" id="pdfItemsCount">‚Äî</span>
                </div>

                <!-- –û–±—â–∏–π –≤–µ—Å -->
                <div class="pdf-info-row" id="pdfWeightRow">
                    <span class="pdf-info-label">–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞–≥–∞:</span>
                    <span class="pdf-info-value" id="pdfTotalWeight">‚Äî</span>
                </div>

                <!-- –û–±—â–∞—è —Å—É–º–º–∞ (–≤—ã–¥–µ–ª–µ–Ω–∞) -->
                <div class="pdf-info-row pdf-info-highlight">
                    <span class="pdf-info-label">–°—É–º–∞:</span>
                    <span class="pdf-info-value pdf-info-amount" id="pdfTotalAmount">‚Äî</span>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∞—Ç—å PDF -->
            <div class="pdf-preview-actions">
                <button class="btn-secondary" id="downloadPdfBtn">
                    <i data-lucide="download"></i>
                    <span>–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF</span>
                </button>
            </div>
        </div>

        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div class="modal-actions">
            <button class="btn-secondary" id="cancelPdfSubmitBtn">
                <i data-lucide="x"></i>
                <span>–°–∫–∞—Å—É–≤–∞—Ç–∏</span>
            </button>
            <button class="btn-primary btn-large" id="confirmPdfSubmitBtn">
                <i data-lucide="check-circle"></i>
                <span>–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</span>
            </button>
        </div>
    </div>
</div>
```

---

## –ü–ª–∞–Ω –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –®–∞–≥ 4: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ app.js

–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:

```javascript
// 1. –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –≤–µ—Å–∞
function calculateTotalWeight(items) {
    return items.reduce((sum, item) => {
        if (item.unit === 'kg') {
            return sum + (Number(item.quantity) || 0);
        }
        return sum;
    }, 0);
}

// 2. –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–π —Å—É–º–º—ã
function calculateTotalAmount(items) {
    return items.reduce((sum, item) => {
        return sum + (Number(item.totalAmount) || 0);
    }, 0);
}

// 3. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF —Ñ–∞–π–ª–∞
function downloadPdfFile(blob, filename) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.rel = 'noopener';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    setTimeout(() => URL.revokeObjectURL(url), 100);
}

// 4. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
function formatDateForFilename(date) {
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const year = date.getFullYear();
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');

    return `${day}-${month}-${year}_${hours}-${minutes}`;
}

// 5. –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–µ–≤—å—é PDF (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise<boolean>)
function showPdfPreviewModal(data) {
    return new Promise((resolve) => {
        const modal = document.getElementById('pdfPreviewModal');

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
        document.getElementById('pdfStoreName').textContent = data.storeName;
        document.getElementById('pdfDate').textContent = data.date;
        document.getElementById('pdfTime').textContent = data.time;
        document.getElementById('pdfItemsCount').textContent =
            `${data.items.length} ${data.items.length === 1 ? '–ø–æ–∑–∏—Ü—ñ—è' : data.items.length < 5 ? '–ø–æ–∑–∏—Ü—ñ—ó' : '–ø–æ–∑–∏—Ü—ñ–π'}`;

        // –í–µ—Å (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ > 0)
        const weightRow = document.getElementById('pdfWeightRow');
        if (data.totalWeight && data.totalWeight > 0) {
            document.getElementById('pdfTotalWeight').textContent = `${data.totalWeight.toFixed(2)} –∫–≥`;
            weightRow.style.display = 'flex';
        } else {
            weightRow.style.display = 'none';
        }

        document.getElementById('pdfTotalAmount').textContent =
            `${data.totalAmount.toFixed(2)} ‚Ç¥`;

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        const confirmBtn = document.getElementById('confirmPdfSubmitBtn');
        const cancelBtn = document.getElementById('cancelPdfSubmitBtn');
        const closeBtn = document.getElementById('closePdfPreviewBtn');
        const downloadBtn = document.getElementById('downloadPdfBtn');

        const cleanup = () => {
            modal.classList.remove('visible');
            confirmBtn.replaceWith(confirmBtn.cloneNode(true));
            cancelBtn.replaceWith(cancelBtn.cloneNode(true));
            closeBtn.replaceWith(closeBtn.cloneNode(true));
            downloadBtn.replaceWith(downloadBtn.cloneNode(true));
        };

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
        document.getElementById('confirmPdfSubmitBtn').addEventListener('click', () => {
            cleanup();
            resolve(true);
        });

        // –û—Ç–º–µ–Ω–∞
        const cancelHandler = () => {
            cleanup();
            resolve(false);
        };
        document.getElementById('cancelPdfSubmitBtn').addEventListener('click', cancelHandler);
        document.getElementById('closePdfPreviewBtn').addEventListener('click', cancelHandler);

        // –°–∫–∞—á–∞—Ç—å PDF
        document.getElementById('downloadPdfBtn').addEventListener('click', () => {
            downloadPdfFile(
                data.pdfBlob,
                `–í—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è_${data.storeName}_${formatDateForFilename(new Date())}.pdf`
            );
            toastManager.show('PDF –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ', 'success');
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
        modal.classList.add('visible');

        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    });
}

// 6. –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ—à–∏–±–∫–∏ PDF
function showPdfErrorModal(error) {
    toastManager.show(
        `–ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó PDF: ${error.message}. –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –Ω–µ–º–æ–∂–ª–∏–≤–∞ –±–µ–∑ –∑–≤—ñ—Ç—É.`,
        'error',
        5000
    );
}
```

### –®–∞–≥ 5: –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å PDF –Ω–∞ —Å–µ—Ä–≤–µ—Ä (src/network.js)

–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –≤ `SecureApiClient`:

```javascript
static async sendUnloadingBatchWithPDF(storeName, items, pdfBlob) {
    if (!this.validateInput(storeName) || !Array.isArray(items) || items.length === 0) {
        throw new Error('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏');
    }

    const webhookUrl = config.N8N_WEBHOOK_URL;
    if (!webhookUrl) {
        throw new Error('URL –≤–µ–±—Ö—É–∫–∞ –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ');
    }

    // –°–æ–∑–¥–∞–µ–º FormData –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞ –∏ –¥–∞–Ω–Ω—ã—Ö
    const formData = new FormData();

    // –î–∞–Ω–Ω—ã–µ –≤ JSON
    const submittedAt = new Date();
    const data = {
        storeName,
        date: submittedAt.toLocaleDateString('uk-UA'),
        time: submittedAt.toLocaleTimeString('uk-UA', {
            hour: '2-digit',
            minute: '2-digit'
        }),
        items: items.map(item => ({
            productName: item.productName,
            quantity: Number(item.quantity),
            unit: item.unit,
            source: item.source,
            pricePerUnit: Number(item.pricePerUnit),
            totalAmount: Number(item.totalAmount),
            timestamp: item.timestamp
        })),
        totalAmount: items.reduce((sum, item) => sum + Number(item.totalAmount || 0), 0),
        totalWeight: items.reduce((sum, item) => {
            if (item.unit === 'kg') {
                return sum + Number(item.quantity || 0);
            }
            return sum;
        }, 0),
        submittedAt: submittedAt.toISOString()
    };

    // –î–æ–±–∞–≤–ª—è–µ–º JSON –∫–∞–∫ —Å—Ç—Ä–æ–∫—É
    formData.append('data', JSON.stringify(data));

    // –î–æ–±–∞–≤–ª—è–µ–º PDF —Ñ–∞–π–ª
    const fileName = `–í—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è_${storeName}_${submittedAt.toISOString().split('T')[0]}.pdf`;
    formData.append('pdf', pdfBlob, fileName);

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º
    const response = await fetch(webhookUrl, {
        method: 'POST',
        body: formData,
        // –ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Content-Type - –±—Ä–∞—É–∑–µ—Ä —Å–∞–º –¥–æ–±–∞–≤–∏—Ç boundary –¥–ª—è multipart
    });

    if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`HTTP ${response.status}: ${errorText}`);
    }

    return await response.json();
}
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–µ—Å–ª–∏ n8n –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç multipart):**

–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å PDF –∫–∞–∫ base64 –≤ JSON:

```javascript
static async sendUnloadingBatchWithPDF(storeName, items, pdfBlob) {
    // ... –≤–∞–ª–∏–¥–∞—Ü–∏—è

    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º PDF –≤ base64
    const pdfBase64 = await blobToBase64(pdfBlob);

    const submittedAt = new Date();
    const data = {
        storeName,
        date: submittedAt.toLocaleDateString('uk-UA'),
        time: submittedAt.toLocaleTimeString('uk-UA', { hour: '2-digit', minute: '2-digit' }),
        items: items.map(item => ({ /* ... */ })),
        totalAmount: /* ... */,
        totalWeight: /* ... */,
        submittedAt: submittedAt.toISOString(),
        pdfBase64: pdfBase64,  // ‚Üê PDF –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ base64
        pdfFileName: `–í—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è_${storeName}_${formatDateForFilename(submittedAt)}.pdf`
    };

    const response = await fetch(webhookUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    });

    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
function blobToBase64(blob) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => {
            const base64 = reader.result.split(',')[1]; // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å data:application/pdf;base64,
            resolve(base64);
        };
        reader.onerror = reject;
        reader.readAsDataURL(blob);
    });
}
```

**–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –¥–ª—è n8n webhook?

### –®–∞–≥ 6: –ù–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è submitDraft()

```javascript
async function submitDraft() {
    const storeName = appState.selectedStore;
    if (!storeName) return;

    const draft = await DraftManager.getDraft(storeName);
    if (draft.items.length === 0) {
        toastManager.show('–ß–µ—Ä–Ω–µ—Ç–∫–∞ –ø–æ—Ä–æ–∂–Ω—è', 'error');
        return;
    }

    const submitBtn = document.getElementById('submitDraftBtn');
    const submitBtnText = document.getElementById('submitDraftBtnText');

    if (!submitBtn) return;

    const originalText = submitBtnText?.textContent || '–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤—Å—ñ';

    // ===== –®–ê–ì 1: –ì–ï–ù–ï–†–ê–¶–ò–Ø PDF (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!) =====
    submitBtn.disabled = true;
    if (submitBtnText) {
        submitBtnText.textContent = '–ì–µ–Ω–µ—Ä—É—î–º–æ –∑–≤—ñ—Ç...';
    }

    let pdfResult;
    try {
        const submissionTimestamp = new Date();
        const totalAmount = calculateTotalAmount(draft.items);
        const totalWeight = calculateTotalWeight(draft.items);

        pdfResult = await generateUnloadingReport({
            storeName,
            items: draft.items,
            submittedAt: submissionTimestamp,
            totalWeight,
            summary: `–í—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ${draft.items.length} –ø–æ–∑–∏—Ü—ñ–π –Ω–∞ —Å—É–º—É ${totalAmount.toFixed(2)} ‚Ç¥.`
        }, { download: false }); // –ù–ï —Å–∫–∞—á–∏–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

        console.log('‚úÖ PDF —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω');

    } catch (pdfError) {
        console.error('‚ùå PDF generation error:', pdfError);

        // –ë–õ–û–ö–ò–†–£–ï–ú –æ—Ç–ø—Ä–∞–≤–∫—É!
        submitBtn.disabled = false;
        if (submitBtnText) {
            submitBtnText.textContent = originalText;
        }

        showPdfErrorModal(pdfError);
        return; // –°–¢–û–ü! –ë–µ–∑ PDF –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
    }

    // ===== –®–ê–ì 2: –ü–û–ö–ê–ó–´–í–ê–ï–ú –ü–†–ï–í–¨–Æ –ò –ñ–î–ï–ú –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø =====
    submitBtn.disabled = false;
    if (submitBtnText) {
        submitBtnText.textContent = originalText;
    }

    const confirmed = await showPdfPreviewModal({
        storeName,
        items: draft.items,
        date: new Date().toLocaleDateString('uk-UA'),
        time: new Date().toLocaleTimeString('uk-UA', { hour: '2-digit', minute: '2-digit' }),
        totalAmount: calculateTotalAmount(draft.items),
        totalWeight: calculateTotalWeight(draft.items),
        pdfBlob: pdfResult.blob
    });

    if (!confirmed) {
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª - PDF –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
        toastManager.show('–í—ñ–¥–ø—Ä–∞–≤–∫—É —Å–∫–∞—Å–æ–≤–∞–Ω–æ', 'info');
        return;
    }

    // ===== –®–ê–ì 3: –û–¢–ü–†–ê–í–ö–ê –ù–ê –°–ï–†–í–ï–† (–î–ê–ù–ù–´–ï + PDF) =====
    submitBtn.disabled = true;
    if (submitBtnText) {
        submitBtnText.textContent = '–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ...';
    }

    try {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ + PDF –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        await SecureApiClient.sendUnloadingBatchWithPDF(
            storeName,
            draft.items,
            pdfResult.blob
        );

        console.log('‚úÖ Data and PDF sent to server');

        // ===== –®–ê–ì 4: –õ–û–ö–ê–õ–¨–ù–û–ï –°–û–•–†–ê–ù–ï–ù–ò–ï =====
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        for (const item of draft.items) {
            await SecureStorageManager.addToHistory(item);

            // –û–±–Ω–æ–≤–ª—è–µ–º inventory
            if (item.source === 'purchase') {
                await InventoryManager.removeStock(item.productName, item.quantity, item.unit);
            }
        }

        refreshOperationsSummaryIfVisible();

        // ===== –®–ê–ì 5: –°–ö–ê–ß–ò–í–ê–ï–ú PDF –õ–û–ö–ê–õ–¨–ù–û =====
        downloadPdfFile(pdfResult.blob, pdfResult.fileName);

        // ===== –®–ê–ì 6: –£–°–ü–ï–• - –£–î–ê–õ–Ø–ï–ú –ß–ï–†–ù–û–í–ò–ö =====
        await DraftManager.deleteDraft(storeName);

        toastManager.show(
            `–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ ${draft.items.length} —Ç–æ–≤–∞—Ä—ñ–≤. PDF –∑–±–µ—Ä–µ–∂–µ–Ω–æ —É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è—Ö`,
            'success'
        );

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–ø–∏—Å–∫—É —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤
        appState.setScreen('drafts-list');
        await showDraftsList();

    } catch (serverError) {
        console.error('‚ùå Server submit error:', serverError);

        // –°–µ—Ä–≤–µ—Ä —É–ø–∞–ª, –Ω–æ PDF —É–∂–µ –µ—Å—Ç—å - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ
        downloadPdfFile(pdfResult.blob, pdfResult.fileName);

        toastManager.show(
            '–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä. PDF –∑–±–µ—Ä–µ–∂–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑',
            'error',
            5000
        );

        // –ß–µ—Ä–Ω–æ–≤–∏–∫ –ù–ï —É–¥–∞–ª—è–µ–º - –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É
    } finally {
        submitBtn.disabled = false;
        if (submitBtnText) {
            submitBtnText.textContent = originalText;
        }
    }
}
```

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: PDF –Ω–µ —Å–æ–∑–¥–∞–ª—Å—è
```
‚ùå generateUnloadingReport() —É–ø–∞–ª
    ‚Üì
–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    ‚Üì
–ë–õ–û–ö–ò–†–£–ï–ú –æ—Ç–ø—Ä–∞–≤–∫—É
    ‚Üì
–ß–µ—Ä–Ω–æ–≤–∏–∫ –æ—Å—Ç–∞–µ—Ç—Å—è
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: PDF —Å–æ–∑–¥–∞–ª—Å—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª
```
‚úÖ PDF —Å–æ–∑–¥–∞–Ω
    ‚Üì
–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–°–∫–∞—Å—É–≤–∞—Ç–∏"
    ‚Üì
–í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —á–µ—Ä–Ω–æ–≤–∏–∫—É
    ‚Üì
PDF –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (–Ω–µ —Å–∫–∞—á–∞–Ω)
    ‚Üì
–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏ - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º PDF –∑–∞–Ω–æ–≤–æ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: PDF —Å–æ–∑–¥–∞–ª—Å—è, —Å–µ—Ä–≤–µ—Ä —É–ø–∞–ª
```
‚úÖ PDF —Å–æ–∑–¥–∞–Ω
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª
    ‚Üì
‚ùå SecureApiClient.sendUnloadingBatchWithPDF() —É–ø–∞–ª
    ‚Üì
–°–∫–∞—á–∏–≤–∞–µ–º PDF –ª–æ–∫–∞–ª—å–Ω–æ
    ‚Üì
–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
    ‚Üì
–ß–µ—Ä–Ω–æ–≤–∏–∫ –ù–ï —É–¥–∞–ª—è–µ–º
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –í—Å–µ —É—Å–ø–µ—à–Ω–æ
```
‚úÖ PDF —Å–æ–∑–¥–∞–Ω
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª
    ‚Üì
‚úÖ –î–∞–Ω–Ω—ã–µ + PDF –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    ‚Üì
‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
    ‚Üì
‚úÖ PDF —Å–∫–∞—á–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ
    ‚Üì
‚úÖ –ß–µ—Ä–Ω–æ–≤–∏–∫ —É–¥–∞–ª–µ–Ω
    ‚Üì
‚úÖ –í–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤
```

---

## Backend (n8n webhook)

### –ß—Ç–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

1. **–ü—Ä–∏–µ–º multipart/form-data** –∏–ª–∏ **JSON —Å base64**

2. **–ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö:**
   - `data` (JSON) - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–∞—Ö
   - `pdf` (File/base64) - PDF —Ñ–∞–π–ª

3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ PDF:**
   - Google Drive (—Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤)
   - –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª

4. **–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
   - Gmail: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ —Å –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–º PDF
   - Telegram: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ + PDF –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç

5. **–û—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É:**
```json
{
  "success": true,
  "message": "–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ",
  "pdfUrl": "https://drive.google.com/file/d/...",
  "emailSent": true,
  "telegramSent": true
}
```

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –£–ª—É—á—à–∏—Ç—å PDF –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä - –ó–ê–í–ï–†–®–ï–ù–û
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ - –ó–ê–í–ï–†–®–ï–ù–û
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏–ª–∏ - –ó–ê–í–ï–†–®–ï–ù–û
4. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ app.js - –í –†–ê–ë–û–¢–ï
5. ‚è≥ –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å PDF
6. ‚è≥ –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å submitDraft()
7. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–æ–¥–∞ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç:
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å n8n webhook –¥–ª—è –ø—Ä–∏–µ–º–∞ PDF
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (Google Drive, Gmail, Telegram)
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å flow –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞
