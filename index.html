<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>–û–±–ª—ñ–∫ –∑–∞–∫—É–ø—ñ–≤–µ–ª—å</title>

    <!-- CSP –¥–ª—è –±–µ–∑–ø–µ–∫–∏ -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' https://unpkg.com https://cdn.jsdelivr.net;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
        font-src 'self' https://fonts.gstatic.com;
        img-src 'self' data: blob:;
        connect-src 'self' https://n8n.dmytrotovstytskyi.online https://generativelanguage.googleapis.com https://unpkg.com https://cdn.jsdelivr.net;
    ">

    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans:wght@400;500;600;700&display=swap&subset=cyrillic" rel="stylesheet">
    <link rel="preload" href="fonts/NotoSans-Regular.ttf" as="font" type="font/ttf" crossorigin>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4f46e5">
</head>
<body>
    <header class="app-header">
        <div class="header-content">
            <button class="back-button" id="backButton" style="display: none;" type="button" aria-label="–ù–∞–∑–∞–¥">
                <i data-lucide="arrow-left"></i>
            </button>
            <h1 class="header-title" id="headerTitle">–û–±–ª—ñ–∫ –∑–∞–∫—É–ø—ñ–≤–µ–ª—å</h1>
            <div class="header-actions">
                <button class="mode-toggle" id="modeToggle" type="button" aria-pressed="false">
                    <span class="mode-indicator"></span>
                    <span id="modeToggleLabel">–†–æ–±–æ—á–∏–π —Ä–µ–∂–∏–º</span>
                </button>
                <button class="theme-toggle" id="themeToggle" type="button" aria-label="–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É">
                    <i data-lucide="moon" class="theme-icon"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="loading-screen" id="loadingScreen">
            <div class="loading-spinner"></div>
            <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
        </div>

        <div class="screen" id="mainScreen" style="display: none;">
            <!-- –ì–æ–ª–æ–≤–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ (purchases) -->
            <div class="tab-content" id="purchasesTab" style="display: none;">
                <div class="purchases-page">
                    <div class="page-header">
                        <h2>–û–±–µ—Ä—ñ—Ç—å –¥—ñ—é</h2>
                        <p>–í–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü—ñ—ó –¥–ª—è –æ–±–ª—ñ–∫—É</p>
                    </div>

                    <div class="current-date-widget glassmorphism">
                        <div class="date-icon">
                            <i data-lucide="calendar"></i>
                        </div>
                        <div class="date-content">
                            <div class="date-day" id="currentDay">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
                            <div class="date-full" id="currentDate">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
                        </div>
                    </div>

                    <div class="categories-grid">
                        <div class="category-row">
                            <button class="category-card start-purchase glassmorphism" id="startPurchaseBtn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="category-icon"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                                <span class="category-label">–ü–æ—á–∞—Ç–∏ –∑–∞–∫—É–ø–∫—É</span>
                            </button>
                        </div>
                        <div class="category-row">
                            <button class="category-card unloading glassmorphism" id="startUnloadingBtn">
                                <i data-lucide="truck" class="category-icon"></i>
                                <span class="category-label">–í—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</span>
                            </button>
                            <button class="category-card delivery glassmorphism" id="startDeliveryBtn">
                                <i data-lucide="package" class="category-icon"></i>
                                <span class="category-label">–î–æ—Å—Ç–∞–≤–∫–∞</span>
                            </button>
                        </div>
                        <div class="end-day-section">
                            <button class="end-day-button" id="endDayBtn">
                                <i data-lucide="sunset"></i>
                                <span>–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –¥–µ–Ω—å</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ —ñ—Å—Ç–æ—Ä—ñ—ó -->
            <div class="tab-content" id="historyTab" style="display: none;">
                <div class="page-header">
                    <h2>–Ü—Å—Ç–æ—Ä—ñ—è –æ–ø–µ—Ä–∞—Ü—ñ–π</h2>
                    <p id="historySummary">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
                </div>
                <div class="history-page">
                    <div class="history-items" id="historyItems"></div>
                    <div class="cart-empty" id="historyEmpty" style="display: none;">
                        <div class="empty-icon">üì¶</div>
                        <p>–¢—É—Ç –±—É–¥–µ —ñ—Å—Ç–æ—Ä—ñ—è –≤–∞—à–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω —Å–ø–∏—Å–∫—É —á–µ—Ä–Ω–µ—Ç–æ–∫ –≤—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è -->
        <div class="screen" id="draftsListScreen" style="display: none;">
            <div class="purchases-page">
                <div class="page-header">
                    <h2>–ß–µ—Ä–Ω–µ—Ç–∫–∏ –≤—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</h2>
                    <p id="draftsListSummary">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
                </div>

                <div class="drafts-list" id="draftsList">
                    <!-- –ß–µ—Ä–Ω–µ—Ç–∫–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                </div>

                <div class="cart-empty" id="draftsEmpty" style="display: none;">
                    <div class="empty-icon">üìã</div>
                    <p>–ù–µ–º–∞—î —á–µ—Ä–Ω–µ—Ç–æ–∫. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—É –∑–∞—è–≤–∫—É!</p>
                </div>

                <div class="fixed-bottom-button">
                    <button class="btn-primary new-draft-button" id="newDraftBtn" type="button">
                        <i data-lucide="plus"></i>
                        <span>–ù–æ–≤–∞ –∑–∞—è–≤–∫–∞</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –≤–∏–±–æ—Ä—É –º–∞–≥–∞–∑–∏–Ω—É –¥–ª—è –≤—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è -->
        <div class="screen" id="storeSelectionScreen" style="display: none;">
            <div class="purchases-page">
                <div class="page-header">
                    <h2>–û–±–µ—Ä—ñ—Ç—å –º–∞–≥–∞–∑–∏–Ω</h2>
                    <p>–í–∏–±–µ—Ä—ñ—Ç—å –º–∞–≥–∞–∑–∏–Ω –¥–ª—è –≤—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</p>
                </div>

                <div class="stores-grid" id="storesGrid">
                    <!-- –ú–∞–≥–∞–∑–∏–Ω–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –ø–µ—Ä–µ–≥–ª—è–¥—É —á–µ—Ä–Ω–µ—Ç–∫–∏ (—Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤) -->
        <div class="screen" id="draftViewScreen" style="display: none;">
            <div class="purchases-page">
                <div class="page-header">
                    <h2 id="draftViewTitle">–ß–µ—Ä–Ω–µ—Ç–∫–∞</h2>
                    <p id="draftViewSummary">0 —Ç–æ–≤–∞—Ä—ñ–≤</p>
                </div>

                <div class="draft-items" id="draftItems">
                    <!-- –¢–æ–≤–∞—Ä–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                </div>

                <div class="cart-empty" id="draftItemsEmpty" style="display: none;">
                    <div class="empty-icon">üì¶</div>
                    <p>–ù–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π —Ç–æ–≤–∞—Ä!</p>
                </div>

                <div class="draft-actions">
                    <button class="btn-secondary add-item-button" id="addItemToDraftBtn" type="button">
                        <i data-lucide="plus"></i>
                        <span>–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</span>
                    </button>
                    <button class="btn-primary submit-draft-button" id="submitDraftBtn" type="button">
                        <i data-lucide="send"></i>
                        <span id="submitDraftBtnText">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤—Å—ñ</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω —Å–ø–∏—Å–∫—É —á–µ—Ä–Ω–µ—Ç–æ–∫ –∑–∞–∫—É–ø–æ–∫ -->
        <div class="screen" id="purchaseDraftsListScreen" style="display: none;">
            <div class="purchases-page">
                <div class="page-header">
                    <h2>–ß–µ—Ä–Ω–µ—Ç–∫–∏ –∑–∞–∫—É–ø–æ–∫</h2>
                    <p id="purchaseDraftsListSummary">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
                </div>

                <div class="drafts-list" id="purchaseDraftsList">
                    <!-- –ß–µ—Ä–Ω–µ—Ç–∫–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                </div>

                <div class="cart-empty" id="purchaseDraftsEmpty" style="display: none;">
                    <div class="empty-icon">üìã</div>
                    <p>–ù–µ–º–∞—î —á–µ—Ä–Ω–µ—Ç–æ–∫. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—É –∑–∞–∫—É–ø–∫—É!</p>
                </div>

                <div class="fixed-bottom-button">
                    <button class="btn-primary new-draft-button" id="newPurchaseDraftBtn" type="button">
                        <i data-lucide="plus"></i>
                        <span>–ù–æ–≤–∞ –∑–∞–∫—É–ø–∫–∞</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –≤–∏–±–æ—Ä—É –ª–æ–∫–∞—Ü—ñ—ó –¥–ª—è –∑–∞–∫—É–ø–∫–∏ -->
        <div class="screen" id="purchaseLocationSelectionScreen" style="display: none;">
            <div class="purchases-page">
                <div class="page-header">
                    <h2>–û–±–µ—Ä—ñ—Ç—å –ª–æ–∫–∞—Ü—ñ—é</h2>
                    <p>–í–∏–±–µ—Ä—ñ—Ç—å –ª–æ–∫–∞—Ü—ñ—é –¥–ª—è –∑–∞–∫—É–ø–∫–∏</p>
                </div>

                <div class="stores-grid" id="purchaseLocationsGrid">
                    <!-- –õ–æ–∫–∞—Ü—ñ—ó –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –ø–µ—Ä–µ–≥–ª—è–¥—É —á–µ—Ä–Ω–µ—Ç–∫–∏ –∑–∞–∫—É–ø–∫–∏ -->
        <div class="screen" id="purchaseDraftViewScreen" style="display: none;">
            <div class="purchases-page">
                <div class="page-header">
                    <h2 id="purchaseDraftViewTitle">–ß–µ—Ä–Ω–µ—Ç–∫–∞ –∑–∞–∫—É–ø–∫–∏</h2>
                    <p id="purchaseDraftViewSummary">0 —Ç–æ–≤–∞—Ä—ñ–≤</p>
                </div>

                <div class="draft-items" id="purchaseDraftItems">
                    <!-- –¢–æ–≤–∞—Ä–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                </div>

                <div class="cart-empty" id="purchaseDraftItemsEmpty" style="display: none;">
                    <div class="empty-icon">üì¶</div>
                    <p>–ù–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π —Ç–æ–≤–∞—Ä!</p>
                </div>

                <div class="draft-actions">
                    <button class="btn-secondary add-item-button" id="addItemToPurchaseDraftBtn" type="button">
                        <i data-lucide="plus"></i>
                        <span>–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</span>
                    </button>
                    <button class="btn-primary submit-draft-button" id="submitPurchaseDraftBtn" type="button">
                        <i data-lucide="send"></i>
                        <span id="submitPurchaseDraftBtnText">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤—Å—ñ</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="screen" id="purchaseFormScreen" style="display: none;">
            <div class="purchase-form-page">
                <div class="page-header">
                    <h2 id="formTitle">–ù–æ–≤–∞ –∑–∞–∫—É–ø—ñ–≤–ª—è</h2>
                    <p id="formSubtitle">–í–∫–∞–∂—ñ—Ç—å –¥–∞–Ω—ñ –ø—Ä–æ —Ç–æ–≤–∞—Ä</p>
                </div>
                <div class="form-container glassmorphism">
                    <form class="purchase-form" id="purchaseForm" novalidate>
                        <div class="form-group">
                            <label for="productName">–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É *</label>
                            <input type="text" id="productName" list="productSuggestions" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ü–æ–º—ñ–¥–æ—Ä–∏ —á–µ—Ä–≤–æ–Ω—ñ" required autocomplete="off">
                            <datalist id="productSuggestions"></datalist>
                            <span class="field-error" id="productName-error"></span>
                        </div>

                        <div class="form-group">
                            <label for="quantity">–ö—ñ–ª—å–∫—ñ—Å—Ç—å *</label>
                            <input type="number" id="quantity" step="0.1" min="0" placeholder="0" required>
                            <span class="field-error" id="quantity-error"></span>
                        </div>

                        <div class="form-group">
                            <label for="unit">–û–¥–∏–Ω–∏—Ü—è –≤–∏–º—ñ—Ä—É *</label>
                            <select id="unit" required></select>
                            <span class="field-error" id="unit-error"></span>
                        </div>

                        <div class="form-group" id="priceGroup">
                            <label for="pricePerUnit">–¶—ñ–Ω–∞ –∑–∞ –æ–¥–∏–Ω–∏—Ü—é, ‚Ç¥</label>
                            <input type="number" id="pricePerUnit" step="0.01" min="0" placeholder="0.00">
                            <span class="field-error" id="pricePerUnit-error"></span>
                        </div>

                        <div class="form-group">
                            <label for="location" id="locationLabel">–õ–æ–∫–∞—Ü—ñ—è *</label>
                            <select id="location" required></select>
                            <span class="field-error" id="location-error"></span>
                        </div>

                        <div class="form-group" id="customLocationGroup" style="display: none;">
                            <label for="customLocation">–í–∫–∞–∂—ñ—Ç—å –ª–æ–∫–∞—Ü—ñ—é *</label>
                            <input type="text" id="customLocation" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –ª–æ–∫–∞—Ü—ñ—ó">
                            <span class="field-error" id="customLocation-error"></span>
                        </div>

                        <!-- –î–∂–µ—Ä–µ–ª–æ —Ç–æ–≤–∞—Ä—É –¥–ª—è —Å–∫–ª–∞–¥—Å—å–∫–∏—Ö –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ -->
                        <div class="form-group" id="sourceGroup" style="display: none;">
                            <label>–î–∂–µ—Ä–µ–ª–æ —Ç–æ–≤–∞—Ä—É *</label>
                            <div id="sourceOptions" class="source-options">
                                <!-- Radio buttons –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                            </div>
                            <span class="field-error" id="source-error"></span>
                            <div id="stockInfo" class="stock-info" style="display: none;"></div>
                        </div>

                        <div class="form-group">
                            <label>–§–æ—Ç–æ —Ç–æ–≤–∞—Ä—É</label>
                            <div class="photo-uploader">
                                <input type="file" id="photoInput" accept="image/*,.heic,.heif" style="display: none;">
                                <button type="button" class="photo-button" id="photoButton">
                                    <i data-lucide="camera"></i>
                                    <span>–î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ</span>
                                </button>
                                <div class="photo-preview" id="photoPreview" style="display: none;">
                                    <img id="previewImage" alt="–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥">
                                    <div id="photoPreviewFallback" class="photo-preview-fallback" style="display: none;">
                                        –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è —Ü—å–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É, –∞–ª–µ —Ñ–∞–π–ª –±—É–¥–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ.
                                    </div>
                                    <button type="button" class="remove-photo" id="removePhotoBtn">
                                        <i data-lucide="x"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="total-display" id="totalGroup">
                            <span id="totalAmount">0.00 ‚Ç¥</span>
                        </div>

                        <button type="submit" class="save-button" id="saveButton">
                            <i data-lucide="save" class="button-icon"></i>
                            <span class="button-spinner" style="display: none;"></span>
                            <span id="saveButtonText">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ –æ–±–ª—ñ–∫</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –≤–∏–±–æ—Ä—É –º–µ—Ç–æ–¥—É –≤–≤–µ–¥–µ–Ω–Ω—è –¥–ª—è –ú–µ—Ç—Ä–æ -->
        <div class="screen" id="metroMethodSelectionScreen" style="display: none;">
            <div class="purchases-page">
                <div class="page-header">
                    <h2>–ú–µ—Ç—Ä–æ - –û–±–µ—Ä—ñ—Ç—å –º–µ—Ç–æ–¥</h2>
                    <p>–Ø–∫ –≤–∏ —Ö–æ—á–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä–∏?</p>
                </div>

                <div class="method-selection-grid">
                    <button class="method-card scan-method glassmorphism" id="scanReceiptBtn" type="button">
                        <div class="method-icon">
                            <i data-lucide="scan"></i>
                        </div>
                        <h3>–°–∫–∞–Ω—É–≤–∞—Ç–∏ —á–µ–∫</h3>
                        <p>AI —Ä–æ–∑–ø—ñ–∑–Ω–∞—î –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏ –∑ —Ñ–æ—Ç–æ —á–µ–∫–∞</p>
                        <div class="method-badge">–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ</div>
                    </button>

                    <button class="method-card manual-method glassmorphism" id="manualEntryBtn" type="button">
                        <div class="method-icon">
                            <i data-lucide="edit"></i>
                        </div>
                        <h3>–í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É</h3>
                        <p>–î–æ–¥–∞–≤–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏ –ø–æ –æ–¥–Ω–æ–º—É</p>
                    </button>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è —á–µ–∫–∞ -->
        <div class="screen" id="receiptScanScreen" style="display: none;">
            <div class="purchases-page">
                <div class="page-header">
                    <h2>–°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—É–π—Ç–µ —á–µ–∫</h2>
                    <p>–ó—Ä–æ–±—ñ—Ç—å —á—ñ—Ç–∫–µ —Ñ–æ—Ç–æ –≤—Å—å–æ–≥–æ —á–µ–∫–∞</p>
                </div>

                <div class="receipt-scan-container">
                    <div class="receipt-camera-area">
                        <div class="receipt-camera-view">
                            <div class="receipt-camera-placeholder" id="receiptCameraPlaceholder">
                                <i data-lucide="camera"></i>
                                <p>–ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ —á–µ–∫ –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ</p>
                            </div>

                            <div class="receipt-camera-stream" id="receiptCameraStreamWrapper" style="display: none;">
                                <video id="receiptCameraStream" autoplay playsinline></video>
                            </div>

                            <div class="receipt-preview" id="receiptPreview" style="display: none;">
                                <img id="receiptPreviewImage" alt="–§–æ—Ç–æ —á–µ–∫–∞">
                                <button class="retake-photo-btn" id="retakePhotoBtn" type="button">
                                    <i data-lucide="refresh-cw"></i>
                                    <span>–ü–µ—Ä–µ—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—É–≤–∞—Ç–∏</span>
                                </button>
                            </div>
                        </div>

                        <div class="receipt-camera-controls" id="receiptCameraActions">
                            <button class="receipt-camera-button" id="openCameraBtn" type="button">
                                <i data-lucide="camera"></i>
                                <span>–ó—Ä–æ–±–∏—Ç–∏ —Ñ–æ—Ç–æ</span>
                            </button>
                            <button class="receipt-gallery-button" id="chooseReceiptPhotoBtn" type="button">
                                <i data-lucide="image"></i>
                                <span>–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–æ—Ç–æ</span>
                            </button>
                        </div>
                    </div>

                    <div class="scanning-status" id="scanningStatus" style="display: none;">
                        <div class="loading-spinner"></div>
                        <h3>AI —Ä–æ–∑–ø—ñ–∑–Ω–∞—î —á–µ–∫...</h3>
                        <p>–¶–µ –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ –¥–æ 10 —Å–µ–∫—É–Ω–¥</p>
                    </div>

                    <div class="receipt-tips glassmorphism">
                        <h4><i data-lucide="info"></i> –ü–æ—Ä–∞–¥–∏ –¥–ª—è –∫—Ä–∞—â–æ–≥–æ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è:</h4>
                        <ul>
                            <li>–†–æ–∑–ø—Ä–∞–≤—Ç–µ —á–µ–∫ —ñ –ø–æ–∫–ª–∞–¥—ñ—Ç—å –Ω–∞ —Ä—ñ–≤–Ω—É –ø–æ–≤–µ—Ä—Ö–Ω—é</li>
                            <li>–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –≤–µ—Å—å —á–µ–∫ –≤–∏–¥–Ω–æ –Ω–∞ —Ñ–æ—Ç–æ</li>
                            <li>–£–Ω–∏–∫–∞–π—Ç–µ –≤—ñ–¥–±–ª–∏—Å–∫—ñ–≤ —Ç–∞ —Ç—ñ–Ω–µ–π</li>
                            <li>–¢—Ä–∏–º–∞–π—Ç–µ –∫–∞–º–µ—Ä—É —Ä—ñ–≤–Ω–æ –Ω–∞–¥ —á–µ–∫–æ–º</li>
                        </ul>
                    </div>

                    <button class="process-receipt-btn btn-primary" id="processReceiptBtn" type="button" style="display: none;">
                        <i data-lucide="sparkles"></i>
                        <span>–†–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏ —á–µ–∫</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ä–æ–∑–ø—ñ–∑–Ω–∞–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤ -->
        <div class="screen" id="recognizedItemsScreen" style="display: none;">
            <div class="purchases-page">
                <div class="page-header">
                    <h2>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–æ–∑–ø—ñ–∑–Ω–∞–Ω—ñ —Ç–æ–≤–∞—Ä–∏</h2>
                    <p id="recognizedItemsSummary">0 —Ç–æ–≤–∞—Ä—ñ–≤ —Ä–æ–∑–ø—ñ–∑–Ω–∞–Ω–æ</p>
                </div>

                <div class="recognized-items-list" id="recognizedItemsList">
                    <!-- –¢–æ–≤–∞—Ä–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                </div>

                <div class="cart-empty" id="recognizedItemsEmpty" style="display: none;">
                    <div class="empty-icon">‚ö†Ô∏è</div>
                    <p>AI –Ω–µ –∑–º—ñ–≥ —Ä–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏ —Ç–æ–≤–∞—Ä–∏ –∑ —á–µ–∫–∞</p>
                    <button class="btn-secondary" id="tryAgainBtn" type="button">
                        <i data-lucide="refresh-cw"></i>
                        <span>–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑</span>
                    </button>
                </div>

                <div class="recognized-items-actions">
                    <button class="btn-secondary" id="addManualItemBtn" type="button">
                        <i data-lucide="plus"></i>
                        <span>–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</span>
                    </button>
                    <button class="btn-primary" id="confirmRecognizedItemsBtn" type="button">
                        <i data-lucide="check"></i>
                        <span id="confirmRecognizedItemsBtnText">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤—Å—ñ</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <nav class="bottom-navigation" id="bottomNavigation">
        <button class="nav-button active" data-tab="purchases" id="navPurchases">
            <i data-lucide="home"></i>
            <span>–ì–æ–ª–æ–≤–Ω–∞</span>
        </button>
        <button class="nav-button" data-tab="history" id="navHistory">
            <i data-lucide="clock"></i>
            <span>–Ü—Å—Ç–æ—Ä—ñ—è</span>
        </button>
    </nav>

    <div class="toast-container" id="toastContainer"></div>

    <!-- Modal –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ä–æ–∑–ø—ñ–∑–Ω–∞–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É -->
    <div class="modal-overlay" id="recognizedItemEditModal">
        <div class="modal-content glassmorphism recognized-edit-modal">
            <div class="modal-header">
                <h3>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä</h3>
                <button class="modal-close" id="closeRecognizedEditBtn" type="button">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <form class="recognized-edit-form" id="recognizedEditForm">
                <div class="form-group">
                    <label for="recognizedEditName">–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É</label>
                    <input id="recognizedEditName" name="recognizedEditName" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ü–æ–º—ñ–¥–æ—Ä–∏" required type="text" />
                    <div class="field-error" id="recognizedEditName-error"></div>
                </div>

                <div class="form-group">
                    <label for="recognizedEditQuantity">–ö—ñ–ª—å–∫—ñ—Å—Ç—å</label>
                    <input id="recognizedEditQuantity" min="0" name="recognizedEditQuantity" required step="0.01" type="number" />
                    <div class="field-error" id="recognizedEditQuantity-error"></div>
                </div>

                <div class="form-group">
                    <label for="recognizedEditUnit">–û–¥–∏–Ω–∏—Ü—è –≤–∏–º—ñ—Ä—É</label>
                    <select id="recognizedEditUnit" name="recognizedEditUnit"></select>
                </div>

                <div class="form-group">
                    <label for="recognizedEditPrice">–¶—ñ–Ω–∞ –∑–∞ –æ–¥–∏–Ω–∏—Ü—é (‚Ç¥)</label>
                    <input id="recognizedEditPrice" min="0" name="recognizedEditPrice" required step="0.01" type="number" />
                    <div class="field-error" id="recognizedEditPrice-error"></div>
                </div>

                <div class="recognized-edit-summary">
                    <span>–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞</span>
                    <strong id="recognizedEditTotal">0.00 ‚Ç¥</strong>
                </div>

                <div class="modal-actions">
                    <button class="btn-secondary" id="recognizedEditCancelBtn" type="button">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button class="btn-primary" type="submit">
                        <i data-lucide="save"></i>
                        <span>–ó–±–µ—Ä–µ–≥—Ç–∏</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É/—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É –≤ —á–µ—Ä–Ω–µ—Ç—Ü—ñ -->
    <div class="modal-overlay" id="itemViewModal">
        <div class="modal-content glassmorphism item-view-modal">
            <div class="modal-header">
                <h3 id="itemViewTitle">–î–µ—Ç–∞–ª—ñ —Ç–æ–≤–∞—Ä—É</h3>
                <button class="modal-close" id="closeItemViewBtn" type="button">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="item-view-content" id="itemViewContent">
                <div class="item-detail-row">
                    <span class="item-detail-label">–ù–∞–∑–≤–∞:</span>
                    <span class="item-detail-value" id="itemDetailName">-</span>
                </div>
                <div class="item-detail-row">
                    <span class="item-detail-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</span>
                    <span class="item-detail-value" id="itemDetailQuantity">-</span>
                </div>
                <div class="item-detail-row">
                    <span class="item-detail-label">–¶—ñ–Ω–∞ –∑–∞ –æ–¥–∏–Ω–∏—Ü—é:</span>
                    <span class="item-detail-value" id="itemDetailPrice">-</span>
                </div>
                <div class="item-detail-row">
                    <span class="item-detail-label">–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞:</span>
                    <span class="item-detail-value item-detail-total" id="itemDetailTotal">-</span>
                </div>
                <div class="item-detail-row">
                    <span class="item-detail-label">–ú–∞–≥–∞–∑–∏–Ω:</span>
                    <span class="item-detail-value" id="itemDetailLocation">-</span>
                </div>
                <div class="item-detail-row" id="itemDetailSourceRow" style="display: none;">
                    <span class="item-detail-label">–î–∂–µ—Ä–µ–ª–æ:</span>
                    <span class="item-detail-value" id="itemDetailSource">-</span>
                </div>
                <div class="item-detail-row">
                    <span class="item-detail-label">–°—Ç–≤–æ—Ä–µ–Ω–æ:</span>
                    <span class="item-detail-value" id="itemDetailTimestamp">-</span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" id="editItemBtn">
                    <i data-lucide="edit"></i>
                    <span>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</span>
                </button>
                <button class="btn-destructive" id="deleteItemFromModalBtn">
                    <i data-lucide="trash-2"></i>
                    <span>–í–∏–¥–∞–ª–∏—Ç–∏</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥–Ω—è -->
    <div class="modal-overlay" id="endDayModal">
        <div class="modal-content glassmorphism">
            <h3>–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –¥–µ–Ω—å?</h3>
            <p>AI –∑–≥–µ–Ω–µ—Ä—É—î –ø—ñ–¥—Å—É–º–∫–æ–≤–∏–π –∑–≤—ñ—Ç –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤—Å—ñ—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ.</p>
            <div class="modal-actions">
                <button class="btn-secondary" id="cancelEndDayBtn">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                <button class="btn-primary" id="confirmEndDayBtn">–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∑–≤—ñ—Ç</button>
            </div>
        </div>
    </div>

    <!-- Modal –¥–ª—è AI –∑–≤—ñ—Ç—É -->
    <div class="modal-overlay" id="aiSummaryModal">
        <div class="modal-content glassmorphism">
            <h3>–î–µ–Ω–Ω–∏–π –∑–≤—ñ—Ç AI</h3>
            <div id="aiSummaryContent" class="ai-summary-content">
                <div class="loading-spinner"></div>
                <p>–ì–µ–Ω–µ—Ä—É—î–º–æ –∑–≤—ñ—Ç...</p>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" id="closeAiSummaryBtn">–ó–∞–∫—Ä–∏—Ç–∏</button>
                <button class="btn-destructive" id="clearHistoryBtn" style="display: none;">–û—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é</button>
            </div>
        </div>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç–∏ -->
    <script type="importmap" src="import-map.json"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="app.js" type="module"></script>
</body>
</html>
