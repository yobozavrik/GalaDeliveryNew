<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç PWA</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .pass-result { background-color: #d4edda; }
        .fail-result { background-color: #f8d7da; }
        .warning-result { background-color: #fff3cd; }
        .install-button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 3px; cursor: pointer; margin: 5px; }
        .install-button:hover { background: #0056b3; }
        .install-button:disabled { background: #6c757d; cursor: not-allowed; }
    </style>
</head>
<body>
    <h1>üì± –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ PWA —Ñ—É–Ω–∫—Ü–∏–π</h1>
    
    <div class="test-section">
        <h2>1. Web App Manifest</h2>
        <div id="manifest-test" class="test-result">–ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞–Ω–∏—Ñ–µ—Å—Ç...</div>
    </div>
    
    <div class="test-section">
        <h2>2. Service Worker</h2>
        <div id="sw-test" class="test-result">–ü—Ä–æ–≤–µ—Ä—è–µ–º Service Worker...</div>
    </div>
    
    <div class="test-section">
        <h2>3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
        <button class="install-button" id="install-button" onclick="installPWA()" disabled>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
        <div id="install-test" class="test-result">–†–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏...</div>
    </div>
    
    <div class="test-section">
        <h2>4. –û—Ñ–ª–∞–π–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</h2>
        <button class="install-button" onclick="testOffline()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ñ–ª–∞–π–Ω</button>
        <div id="offline-test" class="test-result">–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ñ–ª–∞–π–Ω —Ç–µ—Å—Ç–∞...</div>
    </div>
    
    <div class="test-section">
        <h2>5. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
        <button class="install-button" onclick="testCaching()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
        <div id="cache-test" class="test-result">–†–µ–∑—É–ª—å—Ç–∞—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è...</div>
    </div>
    
    <div class="test-section">
        <h2>6. Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
        <button class="install-button" onclick="testNotifications()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
        <div id="notification-test" class="test-result">–†–µ–∑—É–ª—å—Ç–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...</div>
    </div>
    
    <div class="test-section">
        <h2>7. –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
        <div id="responsive-test" class="test-result">–ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å...</div>
    </div>

    <script>
        let deferredPrompt;
        let swRegistration;
        
        // –¢–µ—Å—Ç Web App Manifest
        function testManifest() {
            const result = document.getElementById('manifest-test');
            
            const manifestLink = document.querySelector('link[rel="manifest"]');
            if (manifestLink) {
                fetch(manifestLink.href)
                    .then(response => response.json())
                    .then(manifest => {
                        const requiredFields = ['name', 'short_name', 'start_url', 'display', 'icons'];
                        const hasRequired = requiredFields.every(field => manifest[field]);
                        
                        if (hasRequired) {
                            result.className = 'test-result pass-result';
                            result.innerHTML = `‚úÖ –ú–∞–Ω–∏—Ñ–µ—Å—Ç –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω<br>
                                –ù–∞–∑–≤–∞–Ω–∏–µ: ${manifest.name}<br>
                                –ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: ${manifest.short_name}<br>
                                –ò–∫–æ–Ω–∫–∏: ${manifest.icons.length}<br>
                                –†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${manifest.display}`;
                        } else {
                            result.className = 'test-result fail-result';
                            result.innerHTML = '‚ùå –ú–∞–Ω–∏—Ñ–µ—Å—Ç –Ω–µ–ø–æ–ª–Ω—ã–π - –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è';
                        }
                    })
                    .catch(error => {
                        result.className = 'test-result fail-result';
                        result.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞: ' + error.message;
                    });
            } else {
                result.className = 'test-result fail-result';
                result.innerHTML = '‚ùå –ú–∞–Ω–∏—Ñ–µ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω';
            }
        }
        
        // –¢–µ—Å—Ç Service Worker
        function testServiceWorker() {
            const result = document.getElementById('sw-test');
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations()
                    .then(registrations => {
                        if (registrations.length > 0) {
                            swRegistration = registrations[0];
                            result.className = 'test-result pass-result';
                            result.innerHTML = `‚úÖ Service Worker –∞–∫—Ç–∏–≤–µ–Ω<br>
                                –°–æ—Å—Ç–æ—è–Ω–∏–µ: ${swRegistration.active ? swRegistration.active.state : '–Ω–µ–∞–∫—Ç–∏–≤–µ–Ω'}<br>
                                Scope: ${swRegistration.scope}`;
                        } else {
                            result.className = 'test-result warning-result';
                            result.innerHTML = '‚ö†Ô∏è Service Worker –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω';
                        }
                    })
                    .catch(error => {
                        result.className = 'test-result fail-result';
                        result.innerHTML = '‚ùå –û—à–∏–±–∫–∞ Service Worker: ' + error.message;
                    });
            } else {
                result.className = 'test-result fail-result';
                result.innerHTML = '‚ùå Service Worker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º';
            }
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PWA
        function installPWA() {
            const result = document.getElementById('install-test');
            
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        result.className = 'test-result pass-result';
                        result.innerHTML = '‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
                    } else {
                        result.className = 'test-result warning-result';
                        result.innerHTML = '‚ö†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º';
                    }
                    deferredPrompt = null;
                });
            } else {
                result.className = 'test-result warning-result';
                result.innerHTML = '‚ö†Ô∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
            }
        }
        
        // –¢–µ—Å—Ç –æ—Ñ–ª–∞–π–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
        function testOffline() {
            const result = document.getElementById('offline-test');
            
            // –°–∏–º—É–ª—è—Ü–∏—è –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞
            const originalOnline = navigator.onLine;
            Object.defineProperty(navigator, 'onLine', {
                writable: true,
                value: false
            });
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
            const testUrls = ['/', '/styles.css', '/app.js'];
            let cachedCount = 0;
            let totalCount = testUrls.length;
            
            Promise.all(testUrls.map(url => 
                fetch(url).then(response => {
                    if (response.ok) cachedCount++;
                }).catch(() => {})
            )).then(() => {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
                Object.defineProperty(navigator, 'onLine', {
                    writable: true,
                    value: originalOnline
                });
                
                if (cachedCount === totalCount) {
                    result.className = 'test-result pass-result';
                    result.innerHTML = `‚úÖ –û—Ñ–ª–∞–π–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç (${cachedCount}/${totalCount} —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã)`;
                } else if (cachedCount > 0) {
                    result.className = 'test-result warning-result';
                    result.innerHTML = `‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è –æ—Ñ–ª–∞–π–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (${cachedCount}/${totalCount} —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã)`;
                } else {
                    result.className = 'test-result fail-result';
                    result.innerHTML = '‚ùå –û—Ñ–ª–∞–π–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç';
                }
            });
        }
        
        // –¢–µ—Å—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
        function testCaching() {
            const result = document.getElementById('cache-test');
            
            if ('caches' in window) {
                caches.keys().then(cacheNames => {
                    if (cacheNames.length > 0) {
                        result.className = 'test-result pass-result';
                        result.innerHTML = `‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ<br>
                            –ö–µ—à–µ–π: ${cacheNames.length}<br>
                            –ù–∞–∑–≤–∞–Ω–∏—è: ${cacheNames.join(', ')}`;
                    } else {
                        result.className = 'test-result warning-result';
                        result.innerHTML = '‚ö†Ô∏è –ö–µ—à–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
                    }
                }).catch(error => {
                    result.className = 'test-result fail-result';
                    result.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–µ—à–µ–π: ' + error.message;
                });
            } else {
                result.className = 'test-result fail-result';
                result.innerHTML = '‚ùå Cache API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
            }
        }
        
        // –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function testNotifications() {
            const result = document.getElementById('notification-test');
            
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    new Notification('–¢–µ—Å—Ç PWA', {
                        body: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç!',
                        icon: '/icon-192.png'
                    });
                    result.className = 'test-result pass-result';
                    result.innerHTML = '‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç';
                } else if (Notification.permission === 'default') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            result.className = 'test-result pass-result';
                            result.innerHTML = '‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–æ';
                        } else {
                            result.className = 'test-result warning-result';
                            result.innerHTML = '‚ö†Ô∏è –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ';
                        }
                    });
                } else {
                    result.className = 'test-result warning-result';
                    result.innerHTML = '‚ö†Ô∏è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã';
                }
            } else {
                result.className = 'test-result fail-result';
                result.innerHTML = '‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è';
            }
        }
        
        // –¢–µ—Å—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏
        function testResponsive() {
            const result = document.getElementById('responsive-test');
            
            const viewport = document.querySelector('meta[name="viewport"]');
            const hasViewport = viewport && viewport.content.includes('width=device-width');
            
            const mediaQueries = [
                '@media (max-width: 768px)',
                '@media (max-width: 480px)',
                '@media (min-width: 1024px)'
            ];
            
            let responsiveCSS = false;
            const styleSheets = Array.from(document.styleSheets);
            styleSheets.forEach(sheet => {
                try {
                    const rules = Array.from(sheet.cssRules || sheet.rules);
                    rules.forEach(rule => {
                        if (rule.type === CSSRule.MEDIA_RULE) {
                            mediaQueries.forEach(mq => {
                                if (rule.media.mediaText.includes(mq)) {
                                    responsiveCSS = true;
                                }
                            });
                        }
                    });
                } catch (e) {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ CORS
                }
            });
            
            const tests = [
                { name: 'Viewport meta tag', passed: hasViewport },
                { name: 'Responsive CSS', passed: responsiveCSS },
                { name: 'Flexible layout', passed: document.querySelector('.main-content') !== null }
            ];
            
            const passed = tests.filter(t => t.passed).length;
            const total = tests.length;
            
            let details = tests.map(t => `${t.name}: ${t.passed ? '‚úÖ' : '‚ùå'}`).join('<br>');
            
            if (passed === total) {
                result.className = 'test-result pass-result';
                result.innerHTML = `‚úÖ –û—Ç–ª–∏—á–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å (${passed}/${total})<br>${details}`;
            } else if (passed >= total * 0.7) {
                result.className = 'test-result warning-result';
                result.innerHTML = `‚ö†Ô∏è –•–æ—Ä–æ—à–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å (${passed}/${total})<br>${details}`;
            } else {
                result.className = 'test-result fail-result';
                result.innerHTML = `‚ùå –ü–ª–æ—Ö–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å (${passed}/${total})<br>${details}`;
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è beforeinstallprompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-button').disabled = false;
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è appinstalled
        window.addEventListener('appinstalled', () => {
            const result = document.getElementById('install-test');
            result.className = 'test-result pass-result';
            result.innerHTML = '‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
        });
        
        // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
        function runAllTests() {
            testManifest();
            testServiceWorker();
            testResponsive();
        }
        
        // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', runAllTests);
    </script>
</body>
</html>
