<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .pass { background-color: #d4edda; border-color: #c3e6cb; }
        .fail { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .pass-result { background-color: #d4edda; }
        .fail-result { background-color: #f8d7da; }
        .warning-result { background-color: #fff3cd; }
    </style>
</head>
<body>
    <h1>üîí –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h1>
    
    <div class="test-section">
        <h2>1. Content Security Policy (CSP)</h2>
        <div id="csp-test" class="test-result">–ü—Ä–æ–≤–µ—Ä—è–µ–º CSP –∑–∞–≥–æ–ª–æ–≤–∫–∏...</div>
    </div>
    
    <div class="test-section">
        <h2>2. XSS –ó–∞—â–∏—Ç–∞</h2>
        <div id="xss-test" class="test-result">–¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞—â–∏—Ç—É –æ—Ç XSS –∞—Ç–∞–∫...</div>
    </div>
    
    <div class="test-section">
        <h2>3. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h2>
        <div id="validation-test" class="test-result">–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º...</div>
    </div>
    
    <div class="test-section">
        <h2>4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</h2>
        <div id="storage-test" class="test-result">–¢–µ—Å—Ç–∏—Ä—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è...</div>
    </div>
    
    <div class="test-section">
        <h2>5. API –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h2>
        <div id="api-test" class="test-result">–ü—Ä–æ–≤–µ—Ä—è–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å API –≤—ã–∑–æ–≤–æ–≤...</div>
    </div>
    
    <div class="test-section">
        <h2>6. HTTPS –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h2>
        <div id="https-test" class="test-result">–ü—Ä–æ–≤–µ—Ä—è–µ–º HTTPS –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏...</div>
    </div>

    <script>
        // –¢–µ—Å—Ç CSP
        function testCSP() {
            const cspTest = document.getElementById('csp-test');
            try {
                // –ü–æ–ø—ã—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å inline —Å–∫—Ä–∏–ø—Ç (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ CSP)
                eval('console.log("CSP test")');
                cspTest.className = 'test-result fail-result';
                cspTest.innerHTML = '‚ùå CSP –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - inline —Å–∫—Ä–∏–ø—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è';
            } catch (e) {
                cspTest.className = 'test-result pass-result';
                cspTest.innerHTML = '‚úÖ CSP —Ä–∞–±–æ—Ç–∞–µ—Ç - inline —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã';
            }
        }
        
        // –¢–µ—Å—Ç XSS –∑–∞—â–∏—Ç—ã
        function testXSSProtection() {
            const xssTest = document.getElementById('xss-test');
            const testDiv = document.createElement('div');
            
            // –¢–µ—Å—Ç 1: textContent vs innerHTML
            const maliciousScript = '<script>alert("XSS")</script>';
            testDiv.textContent = maliciousScript;
            
            if (testDiv.innerHTML.includes('<script>')) {
                xssTest.className = 'test-result fail-result';
                xssTest.innerHTML = '‚ùå XSS —É—è–∑–≤–∏–º–æ—Å—Ç—å - —Å–∫—Ä–∏–ø—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è';
            } else {
                xssTest.className = 'test-result pass-result';
                xssTest.innerHTML = '‚úÖ XSS –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç - —Å–∫—Ä–∏–ø—Ç—ã —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã';
            }
        }
        
        // –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        function testValidation() {
            const validationTest = document.getElementById('validation-test');
            const tests = [
                { input: '', expected: false, name: '–ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞' },
                { input: 'a', expected: false, name: '–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Ç—Ä–æ–∫–∞' },
                { input: 'a'.repeat(101), expected: false, name: '–°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞' },
                { input: '<script>alert("test")</script>', expected: false, name: 'XSS –ø–æ–ø—ã—Ç–∫–∞' },
                { input: '–ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Ç–æ–≤–∞—Ä', expected: true, name: '–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ' }
            ];
            
            let passed = 0;
            let total = tests.length;
            
            tests.forEach(test => {
                // –°–∏–º—É–ª—è—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–∑ app.js
                const sanitized = test.input.replace(/[<>\"'&]/g, (match) => {
                    const escapeMap = { '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#x27;', '&': '&amp;' };
                    return escapeMap[match];
                }).trim();
                
                const isValid = sanitized.length >= 2 && sanitized.length <= 100;
                if (isValid === test.expected) passed++;
            });
            
            if (passed === total) {
                validationTest.className = 'test-result pass-result';
                validationTest.innerHTML = `‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (${passed}/${total} —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ)`;
            } else {
                validationTest.className = 'test-result fail-result';
                validationTest.innerHTML = `‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π (${passed}/${total} —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ)`;
            }
        }
        
        // –¢–µ—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
        function testSecureStorage() {
            const storageTest = document.getElementById('storage-test');
            try {
                // –¢–µ—Å—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                const validItem = {
                    id: 'test-id',
                    productName: '–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä',
                    quantity: 10,
                    unit: '–∫–≥',
                    location: '–¢–µ—Å—Ç–æ–≤–∞—è –ª–æ–∫–∞—Ü–∏—è',
                    timestamp: new Date().toISOString()
                };
                
                // –¢–µ—Å—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                const invalidItem = {
                    id: null,
                    productName: '<script>alert("xss")</script>',
                    quantity: '–Ω–µ —á–∏—Å–ª–æ',
                    unit: null,
                    location: '',
                    timestamp: '–Ω–µ –¥–∞—Ç–∞'
                };
                
                // –°–∏–º—É–ª—è—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–∑ SecureStorageManager
                function validateHistoryItem(item) {
                    return item && 
                           typeof item.id === 'string' &&
                           typeof item.productName === 'string' &&
                           typeof item.quantity === 'number' &&
                           typeof item.unit === 'string' &&
                           typeof item.location === 'string' &&
                           typeof item.timestamp === 'string';
                }
                
                const validResult = validateHistoryItem(validItem);
                const invalidResult = validateHistoryItem(invalidItem);
                
                if (validResult && !invalidResult) {
                    storageTest.className = 'test-result pass-result';
                    storageTest.innerHTML = '‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω–∞';
                } else {
                    storageTest.className = 'test-result fail-result';
                    storageTest.innerHTML = '‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Ö—Ä–∞–Ω–µ–Ω–∏–∏';
                }
            } catch (e) {
                storageTest.className = 'test-result fail-result';
                storageTest.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e.message;
            }
        }
        
        // –¢–µ—Å—Ç API –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        function testAPISecurity() {
            const apiTest = document.getElementById('api-test');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ CSRF –∑–∞—â–∏—Ç—ã
            const hasTimeout = typeof AbortController !== 'undefined';
            const hasCSRF = true; // –í –∫–æ–¥–µ –µ—Å—Ç—å X-Requested-With –∑–∞–≥–æ–ª–æ–≤–æ–∫
            
            if (hasTimeout && hasCSRF) {
                apiTest.className = 'test-result pass-result';
                apiTest.innerHTML = '‚úÖ API –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ - –µ—Å—Ç—å —Ç–∞–π–º–∞—É—Ç—ã –∏ CSRF –∑–∞—â–∏—Ç–∞';
            } else {
                apiTest.className = 'test-result warning-result';
                apiTest.innerHTML = '‚ö†Ô∏è API –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞';
            }
        }
        
        // –¢–µ—Å—Ç HTTPS –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        function testHTTPSAndHeaders() {
            const httpsTest = document.getElementById('https-test');
            const isHTTPS = location.protocol === 'https:';
            const hasSecurityHeaders = true; // –í HTML –µ—Å—Ç—å –º–µ—Ç–∞-—Ç–µ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            
            if (isHTTPS) {
                httpsTest.className = 'test-result pass-result';
                httpsTest.innerHTML = '‚úÖ HTTPS –∞–∫—Ç–∏–≤–µ–Ω - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ';
            } else if (hasSecurityHeaders) {
                httpsTest.className = 'test-result warning-result';
                httpsTest.innerHTML = '‚ö†Ô∏è HTTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –Ω–æ –µ—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è HTTPS –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)';
            } else {
                httpsTest.className = 'test-result fail-result';
                httpsTest.innerHTML = '‚ùå –ù–µ—Ç HTTPS –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏';
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
        function runAllTests() {
            testCSP();
            testXSSProtection();
            testValidation();
            testSecureStorage();
            testAPISecurity();
            testHTTPSAndHeaders();
        }
        
        // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', runAllTests);
    </script>
</body>
</html>
